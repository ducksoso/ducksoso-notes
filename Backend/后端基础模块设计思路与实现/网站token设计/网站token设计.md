

### token认证方式

1. session cookie形式
2. jwt token 形式



**目前一般采用的都是 jwt 签发 token 形式**



用户登录我们的网站需要进行认证，一般是用户输入用户名和密码之后，签发一个token，下次打开网页的时候带着这个token即可，这个token服务端不保存，只负责校验这个token是否合法。



1. 如何签发token？
2. 如何校验token是否合法？
3. token 里是否可以携带用户基础信息（userId … ），或者可以放在哪里？
4. token 过期、用户登出要怎么处理？
5. token 是否可以续期、一定时间内无操作掉线？



### 签名

一个完整的JWT形式是"Header.Payload.Signature"，中间用英文句号的“.”连接起来，如果选择的算法为HS256，那么会将前面的部分进行Base64编码之后，用密钥（secret）进行哈希签名（MD5、SHA256），用表达式就是：

`HMACSHA256(base64UrlEncode(header) + "." +base64UrlEncode(payload), secret)`



签名算法：MD5、SHA256 等，需要密钥的参与

非对称 - rsa 算法：生成私钥、公钥，以及对生成的私钥和公钥进行签名&加密&验证&解密





### 验证

如何验证JWT的有效性呢，比较重要的方法就是验证是否被篡改，当JWT传给服务器之后，服务器用Header和Payload再次执行一次签名，然后比对本次计算得出的签名和JWT传过来的签名是否一致，就可以验证是否被篡改。另外还有一些对“过期时间”之类的校验，这些属于JWT的机制，和签名算法无关。









## 基础知识：

#### RSA算法常用于非对称加密，非对称加密流程如下：

- 乙方生成两把密钥(公钥和私钥)。公钥是公开的，任何人都可以获得，私钥则是保密的。
- 甲方获取乙方的公钥，然后用它对信息加密。
- 乙方得到加密后的信息，用私钥解密。



针对密钥：公钥和私钥 如何在项目中使用，这里举例 go 项目中的运用（**token生成**）



既然是加密，肯定是不希望别人知道我的消息，所以只有我才能解密，所以可得出**公钥负责加密，私钥负责解密**；同理，既然是签名，那肯定是不希望有人冒充我发消息，只有我才能发布这个签名，所以可得出**私钥负责签名，公钥负责验证**。



私钥和公钥是一对，都可以加解密，配对使用。私钥和公钥是一对，谁都可以加解密，只是谁加密谁解密是看情景来用的：

1. 签名：私钥加密公钥解密，能证明“私钥拥有者” 的唯一身份，由于签名（公钥验证签名）。
2. 加密：公钥加密私钥解密，确保发送的信息，只有有“私钥拥有者” 能够接收（如果用私钥加密，传递数据，则会被公钥持有者（可能有很多持有者） 解密，失去对信息的保护）



密钥文件格式一般为：PEM格式







### Golang使用RSA

Golang使用RSA生成公私钥，加密，解密，并使用 SHA256 进行签名，验证 （详见 https://github.com/ducksoso/toolbox/jwt-token）



自己签发自己验证JWT，公钥私钥都存放在同一个地方，RSA有个选项是“密钥位数”，有512、1024、2048、4096等，尽管公私钥都是存在服务器的，但为了防止暴力猜测破解，仍然使用1024位以上比较安全。 







参考：

http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html

http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html

https://blog.csdn.net/q376420785/article/details/8557266

https://studygolang.com/articles/22530

https://zhuanlan.zhihu.com/p/94619052

http://www.bewindoweb.com/301.html







