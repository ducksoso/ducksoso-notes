# set

---

`set`命令是 Bash 脚本的重要环节，却常常被忽视，导致脚本的安全性和可维护性出问题。本文介绍它的基本用法，让你可以更安心地使用 Bash 脚本。

## 一、简介

---

我们知道，Bash 执行脚本的时候，会创建一个新的 Shell。

```bash
bash script.sh
```



上面代码中，`script.sh`是在一个新的 Shell 里面执行。这个 Shell 就是脚本的执行环境，Bash 默认给定了这个环境的各种参数。

`set`命令用来修改 Shell 环境的运行参数，也就是可以定制环境。一共有十几个参数可以定制，[官方手册](https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html)有完整清单，本文介绍其中最常用的四个。

顺便提一下，如果命令行下不带任何参数，直接运行`set`，会显示所有的环境变量和 Shell 函数。



## 二、命令

----

主要是处理脚本执行过程中出现的错误，处理方式！



```bash
// 脚本在头部加上它，遇到不存在的变量就会报错，并停止执行
// -u还有另一种写法-o nounset，两者是等价的
set -u

----------------------------------------------

// set -x用来在运行结果之前，先输出执行的那一行命令
// -x还有另一种写法-o xtrace
set -x

----------------------------------------------

// set -e 使得脚本只要发生错误，就终止执行。
// set +e表示关闭-e选项，set -e表示重新打开-e选项
set -e

// 还有一种方法是使用command || true，使得该命令即使执行失败，脚本也不会终止执行。
foo || true

----------------------------------------------

// set -e有一个例外情况，就是不适用于管道命令。
// 只要管道最后一个子命令不失败，管道命令总是会执行成功。因此它后面命令依然会执行，set -e 就失效了
// 只要一个子命令失败，整个管道命令就失败，脚本就会终止执行
set -o pipefail 

```



## 总结：

`set`命令的上面四个参数，一般都放在一起使用。

```bash
# 写法1：
set -euxo pipefaile

# 写法2:
set -eux
set -o pipefail
```



这两种写法都建议放在所有 Bash 脚本的头部。



另一种办法是在执行 Bash 脚本的时候，从命令行传入这些参数。

```zsh
bash -euxo pipefail script.sh
```



## 参考：

https://www.ruanyifeng.com/blog/2017/11/bash-set.html